<!DOCTYPE html>
<html lang="en">
<head>
	
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1, width=device-width">
	<meta content="IE=edge" http-equiv="X-UA-Compatible">
	
	<title>Fractals</title>
	
	<meta name="keywords" content="mandelbrot,julia,fractals">
	<meta name="description" content="A quick web-based javascript viewer for both the Mandelbrot and Julia sets">
	

</head>
<body>
	<canvas id="viewer" width="800" height="800" style="border:#eee;"></canvas>
	<label id="progresslabel"></label>
  	<progress id="progress" value="0" min="0" max="100"></progress>
	
  	<label id="subprogresslabel">
	</label>
  	<progress id="subprogress" value="0" min="0" max="100"></progress>
	
	<button onclick="draw()">Draw</button>
  <script src="qfm.js"></script>
  <script src="fv.js"></script>
  
  <script>
	  var canceller = {cancel:false};
	  var maxIterations = 500;
	  var lookupTable;
	  
	  (async function () {
		lookupTable = await fv.genLookupTable(800,800,function (subprogress,subprogressTotal,progress,progressTotal) {
			subprogress.value = (subprogress / subprogressTotal) * 100
			subprogresslabel.innerText = `${subprogress} of ${subprogressTotal} Iterations complete`
			
			progress.value = (progress / progressTotal) * 100
			progresslabel.innerText = `${progress} of ${progressTotal} Rounds complete`
		});
		
		  
	  })();
	  
		const canvas = document.getElementById("viewer");
	  	const progress = document.getElementById("progress");
	  	const subprogress = document.getElementById("subprogress");
	  	const progresslabel = document.getElementById("progresslabel");
	  	const subprogresslabel = document.getElementById("subprogresslabel");
	  
	  	const ctx = canvas.getContext('2d', { alpha: false });
	  
	  	lookupFunc = (x,y) => {
			const xi = fv.map(x,0,800,-2,1);
			const yi = fv.map(y,0,800,-1.5,1.5);
			
			const i = qfm.mandelbrot(xi,yi,maxIterations);
			
			if (i === maxIterations) { return "#000000"; }
  			return "hsl(0,100%,"+(i%100)+"%)";
		}
		
		function draw () {
			fv.draw(lookupFunc,lookupTable,ctx,canceller);
		}
		
		
	  
		
	
  </script>
</body>
</html>
